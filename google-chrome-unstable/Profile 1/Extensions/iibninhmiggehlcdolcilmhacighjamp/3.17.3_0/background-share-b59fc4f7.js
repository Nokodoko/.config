import { s, r, a } from './index-9d8fa28c.js';
import { F as Ft, G as Gn, o, R as Rn, r as r$1, K as Kn, d as de, $ as $n, U as Un } from './json-rpc-bbea77b7.js';
import { _ as _t, F as F$1, n as nr, h as ht, q as qt, X as Xt, a as n, y as yt, D as Dt, V as Vt, I as It, b as Ft$1, O as Ot, c as bt, g as gt, E as Et, J as Jt, U as U$1, S as St, d as S, m as mt } from './keysIn-f91c894f.js';

var N=s((function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var t=function(e){var r=e.refreshToken,t=e.shouldRefreshToken,n=e.fetch,o=null;return function(e,a){return null!==o?o.then((function(){return n(e,a)})).catch((function(){return n(e,a)})):n(e,a).catch((function(i){if(t(i))return null===o&&(o=new Promise((function(e,t){r().then((function(){o=null,e();})).catch((function(e){o=null,t(e);}));}))),o.catch((function(){throw i})).then((function(){return n(e,a)}));throw i}))}};r.default=t;}));var R=function(e,r,t){(void 0!==t&&!n(e[r],t)||void 0===t&&!(r in e))&&yt(e,r,t);};var $=function(e){return function(r,t,n){for(var o=-1,a=Object(r),i=n(r),s=i.length;s--;){var u=i[e?s:++o];if(!1===t(a[u],u,a))break}return r}}();var B=function(e){return Ft$1(e)&&qt(e)},I=Function.prototype,C=Object.prototype,F=I.toString,q=C.hasOwnProperty,U=F.call(Object);var D=function(e){if(!Ft$1(e)||"[object Object]"!=S(e))return !1;var r=mt(e);if(null===r)return !0;var t=q.call(r,"constructor")&&r.constructor;return "function"==typeof t&&t instanceof t&&F.call(t)==U};var H=function(e,r){if(("constructor"!==r||"function"!=typeof e[r])&&"__proto__"!=r)return e[r]};var K=function(e){return Jt(e,nr(e))};var V=function(e,r,t,n,o,a,i){var s=H(e,t),u=H(r,t),c=i.get(u);if(c)R(e,t,c);else {var f=a?a(s,u,t+"",e,r,i):void 0,l=void 0===f;if(l){var h=It(u),d=!h&&Dt(u),v=!h&&!d&&Vt(u);f=u,h||d||v?It(s)?f=s:B(s)?f=Ot(s):d?(l=!1,f=bt(u,!0)):v?(l=!1,f=gt(u,!0)):f=[]:D(u)||Et(u)?(f=s,Et(s)?f=K(s):F$1(s)&&!U$1(s)||(f=St(u))):l=!1;}l&&(i.set(u,f),o(f,u,n,a,i),i.delete(u)),R(e,t,f);}};var X=function e(r,t,n,o,a){r!==t&&$(t,(function(i,s){if(a||(a=new _t),F$1(i))V(r,t,s,n,e,o,a);else {var u=o?o(H(r,s),i,s+"",r,t,a):void 0;void 0===u&&(u=i),R(r,s,u);}}),nr);};var z=function(e){return e};var G=function(e,r,t){switch(t.length){case 0:return e.call(r);case 1:return e.call(r,t[0]);case 2:return e.call(r,t[0],t[1]);case 3:return e.call(r,t[0],t[1],t[2])}return e.apply(r,t)},L=Math.max;var Q=function(e,r,t){return r=L(void 0===r?e.length-1:r,0),function(){for(var n=arguments,o=-1,a=L(n.length-r,0),i=Array(a);++o<a;)i[o]=n[r+o];o=-1;for(var s=Array(r+1);++o<r;)s[o]=n[o];return s[r]=t(i),G(e,this,s)}};var W=function(e){return function(){return e}},Y=ht?function(e,r){return ht(e,"toString",{configurable:!0,enumerable:!1,value:W(r),writable:!0})}:z,Z=Date.now;var ee=function(e){var r=0,t=0;return function(){var n=Z(),o=16-(n-t);if(t=n,o>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}(Y);var re=function(e,r){return ee(Q(e,r,z),e+"")};var te=function(e,r,t){if(!F$1(t))return !1;var n$1=typeof r;return !!("number"==n$1?qt(t)&&Xt(r,t.length):"string"==n$1&&r in t)&&n(t[r],e)};var ne=function(e){return re((function(r,t){var n=-1,o=t.length,a=o>1?t[o-1]:void 0,i=o>2?t[2]:void 0;for(a=e.length>3&&"function"==typeof a?(o--,a):void 0,i&&te(t[0],t[1],i)&&(a=o<3?void 0:a,o=1),r=Object(r);++n<o;){var s=t[n];s&&e(r,s,n,a);}return r}))}((function(e,r,t){X(e,r,t);})),oe=s((function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var t,n=(t=ne)&&t.__esModule?t:{default:t};var o=function(e){var r=e.headers.get("content-type");return r&&r.indexOf("json")>=0?e.clone().text().then(a):e.clone().text()},a=function(e){if(!e)return null;try{return JSON.parse(e)}catch(r){throw new Error("Failed to parse unexpected JSON response: ".concat(e))}};function i(e,r,t){this.name="ResponseError",this.status=e,this.response=r,this.body=t;}i.prototype=Error.prototype;var s=function(e){var r=e.response,t=e.body;if(r.ok)return {response:r,body:t};throw new i(r.status,r,t)},u=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=void 0===r.body?r:(0, n.default)({headers:{"Content-Type":"application/json"}},r);return fetch(e,t).then((function(e){return o(e).then((function(r){return {response:e,body:r}}))})).then(s)};r.default=u;})),ae=r(s((function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"configureRefreshFetch",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(r,"fetchJSON",{enumerable:!0,get:function(){return n.default}});var t=o(N),n=o(oe);function o(e){return e&&e.__esModule?e:{default:e}}})));async function ie(e,r={}){const{AUTH_COOKIE_RESTORE_PROMISE:i}=await import('./background-auth-15e91915.js');await i;let s={};return s=o.merge({},r,{credentials:"include",headers:{"X-Extension-Version":`${Rn}/${a.browser.runtime.getManifest().version}`}}),r$1.info(`[API request] url ${e}, with options ${JSON.stringify(s)}`),ae.fetchJSON(e,s)}const se=ae.configureRefreshFetch({fetch:ie,shouldRefreshToken:e=>401===e.response?.status,refreshToken:async function(){const e=`${Un}/sessions/guest`,r={};r.initialApp=Rn;const t=(await Ft({domain:$n,name:"referralCode"}))[0];t&&(r.referralCode=t);const n=await Gn("ateUserId");n&&(r.userId=n,r.checklist={createSnippet:!0,insertSnippet:!0});const a=await Gn("refreshToken");a&&(r.refreshToken=a);const l={method:"POST",body:JSON.stringify(r)},h=(await ie(e,l)).body;h.refreshToken&&await Kn("refreshToken",h.refreshToken);}}),ue=`${Un}/share`,ce={async shareShortcutsByEmail(e){if(!e.emails.length)return;const r={method:"POST",body:JSON.stringify(e)};try{await se(`${ue}/email/collection`,r);}catch(e){throw r$1.error("Error sharing shortcuts by email: ",e),e}},async shareAppByEmail(e){if(!e.emails.length)return;const r={method:"POST",body:JSON.stringify(e)};try{await se(`${ue}/email/app`,r);}catch(e){throw r$1.error("Error sharing app by email: ",e),e}}},fe=new de;fe.method("shareShortcutsByEmail",(async(e,r)=>{try{return await ce.shareShortcutsByEmail(r),!0}catch(e){return r$1.error(e),!1}})),fe.method("shareAppByEmail",(async(e,r)=>{try{return await ce.shareAppByEmail(r),!0}catch(e){return r$1.error(e),!1}}));

export { ae as a, fe as f, se as s };
